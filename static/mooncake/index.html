
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Mooncake: A simplistic validation language</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css?v=dc42388709">

    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="canonical" href="http://localhost:2368/mooncake/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="http://localhost:2368/mooncake/amp/">
    
    <meta property="og:site_name" content="Talal's Zone">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Mooncake: A simplistic validation language">
    <meta property="og:description" content="Validating objects is an important part of many projects. Having gone through significantly large code bases where objects easily get more complex over time. The conventional validation methods can grow even more verbose, less scalable and maintainable. The conventional methods usually comprise of several conditional checks, or perhaps a fancy">
    <meta property="og:url" content="http://localhost:2368/mooncake/">
    <meta property="article:published_time" content="2019-01-21T02:38:40.000Z">
    <meta property="article:modified_time" content="2019-01-21T02:38:40.000Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Mooncake: A simplistic validation language">
    <meta name="twitter:description" content="Validating objects is an important part of many projects. Having gone through significantly large code bases where objects easily get more complex over time. The conventional validation methods can grow even more verbose, less scalable and maintainable. The conventional methods usually comprise of several conditional checks, or perhaps a fancy">
    <meta name="twitter:url" content="http://localhost:2368/mooncake/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Talal Ahmed">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Talal&#x27;s Zone",
        "logo": "http://localhost:2368/favicon.ico"
    },
    "author": {
        "@type": "Person",
        "name": "Talal Ahmed",
        "url": "http://localhost:2368/author/talal/",
        "sameAs": []
    },
    "headline": "Mooncake: A simplistic validation language",
    "url": "http://localhost:2368/mooncake/",
    "datePublished": "2019-01-21T02:38:40.000Z",
    "dateModified": "2019-01-21T02:38:40.000Z",
    "description": "Validating objects is an important part of many projects. Having gone through significantly large code bases where objects easily get more complex over time. The conventional validation methods can grow even more verbose, less scalable and maintainable. The conventional methods usually comprise of several conditional checks, or perhaps a fancy",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <script src="../public/ghost-sdk.js?v=dc42388709"></script>
<script>
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "1d8e5a7e89c2"
});
</script>
    <meta name="generator" content="Ghost 1.25">
    <link rel="alternate" type="application/rss+xml" title="Talal's Zone" href="http://localhost:2368/rss/">

</head>
<body class="post-template">

    <div class="site-wrapper">

        

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="http://localhost:2368">Talal's Zone</a>
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="http://talal.zone/">Home</a></li>
    <li class="nav-main" role="menuitem"><a href="http://talal.zone/">Main</a></li>
</ul>

    </div>
    <div class="site-nav-right">
        <div class="social-links">
        </div>
            <a class="rss-button" href="https://feedly.com/i/subscription/feed/http://localhost:2368/rss/" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg>
</a>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post no-image">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2019-01-21">21 January 2019</time>
                </section>
                <h1 class="post-full-title">Mooncake: A simplistic validation language</h1>
            </header>


            <section class="post-full-content">
                <div class="post-content">
                    <div class="kg-card-markdown"><p>Validating objects is an important part of many projects. Having gone through significantly large code bases where objects easily get more complex over time. The conventional validation methods can grow even more verbose, less scalable and maintainable.</p>
<p>The conventional methods usually comprise of several conditional checks, or perhaps a fancy framework on top using designs like method-chaining etc. After witnessing tremendously huge code files containing such verbose statements and checks. It only came naturally to take the usual behavior of conditionals and turn it into a simplistic language. The language may seem to be specific for a certain solution, but the idea is have it evolve over time while always keeping the simplicity in mind.</p>
<p>Meet "<strong><a href="https://github.com/talal830/mooncake">Mooncake</a></strong>", a descriptive yet less verbose validation language.</p>
<p>The name is inspired from the character <a href="http://final-space.wikia.com/wiki/Mooncake">Mooncake</a> in the tv-series <a href="https://en.wikipedia.org/wiki/Final_Space">Final Space</a>. Mooncake has a minimal vocabulary e.g., "Chookity Dookity", "Chookity-pah", "Woooahhh". However, he manages to describe his sentiments within his limited vocab... and so the inspiration :)</p>
<h2 id="howitworks">How it works</h2>
<p>The language is built with <a href="https://github.com/antlr/antlr4/blob/master/doc/go-target.md">Antlr</a> for GoLang runtime. Antlr is a compiler-compiler which makes it easer to design and test languages.</p>
<p>Currently, objects in Json form can be handled, since behind the scene JsonPath is being used to locate attributes in objects. But this would eventually be replaced by language specific constructs e.g., Golang's structs using methods like reflection.</p>
<p>So to begin with, we need to compose rules that validate different fields/attributes of an object. A simplistic rule composition is as follows:</p>
<pre><code>item.id eq nil =&gt; [E0123, 'id can't be null']!!! # this causes fatal error
</code></pre>
<blockquote>
<p>This says:<br>
if <em>expression:</em> <code>item.id eq nil</code> holds<br>
then <em>implication:</em> <code>[E0123, 'id can't be null']!!!</code></p>
</blockquote>
<p>Breaking down further we have:</p>
<p><em>expression:</em></p>
<ul>
<li><code>item.id</code> -&gt; identifier (attribute path)</li>
<li><code>eq</code> -&gt; operator (equal)</li>
<li><code>nil</code> -&gt; literal (null)</li>
</ul>
<p><em>implication:</em></p>
<ul>
<li><code>E0123</code> -&gt; Error code</li>
<li><code>'id can't be null'</code> -&gt; Error message</li>
<li><code>!!!</code> -&gt; Error severity, here three exclamation marks mean Fatal</li>
<li><code># this causes ...</code> -&gt; Can be any statement related comment (not required)</li>
</ul>
<p>Now, lets see how a group of statements look like:</p>
<pre><code>item.id   eq nil =&gt; [E0123, 'id can't be null']!!!  # this is a fatal error
item.name eq nil =&gt; [E0124, 'name can't be null']!! # this is a severe error
item.addr eq nil =&gt; [E0125, 'addr can't be null']!  # this is a warning error
</code></pre>
<p>All simple and straightforward.</p>
<p>But what about statements which depend on each other? Example: <code>item.name eq nil</code> should be evaluated only if the expression <code>item.id eq nil</code> doesn't hold.</p>
<p>This can easily be done by appending <code>~</code> which allows linking of statements:</p>
<pre><code>~item.id   eq nil =&gt; [E0123, 'id can't be null']!!!  # fatal
~item.name eq nil =&gt; [E0124, 'name can't be null']!! # severe
~item.addr eq nil =&gt; [E0125, 'addr can't be null']!  # warning
</code></pre>
<p>So now all three statements depend on each other. The evaluation is done sequentially in order, which also allows for circuit-breaking.</p>
<p>Statements can also be grouped together in associated blocks. For example, a top level attribute <code>item</code> should always exist, in order to check all the remaining attributes:</p>
<pre><code>item eq nil =&gt; [E0122, 'item can't be null']!!!  # fatal
{
    ~item.id   eq nil =&gt; [E0123, 'id can't be null']!!!  # fatal
    ~item.name eq nil =&gt; [E0124, 'name can't be null']!! # severe
    ~item.addr eq nil =&gt; [E0125, 'addr can't be null']!  # warning
}
</code></pre>
<p>Infact another way of writing linked statements can be with blocks:</p>
<pre><code>item eq nil =&gt; [E0122, 'item can't be null']!!!  # fatal
{
    item.id eq nil =&gt; [E0123, 'id can't be null']!!!  # fatal
    {
        item.name eq nil =&gt; [E0124, 'name can't be null']!! # severe
        {
            item.addr eq nil =&gt; [E0125, 'addr can't be null']!  # warning   
        }
    }
}
</code></pre>
<p>Which is not so cool. Agreed!<br>
So the blocks are more helpful when using declarations. More on this after functions.</p>
<p>Mooncake offers some built-in functions that can be applied to the identifiers and then checked with a literal within an expression.</p>
<p>Here's an example of a length(@len) function:</p>
<pre><code>@len item.list eq 0 =&gt; [E0126, 'list is empty']!! # severe
</code></pre>
<p>It could be the case that the calculated length has to be further filtered or reused in other statements. And so we have a useful case for declarations and blocks:</p>
<pre><code>_x @len item.list eq 0 =&gt; [E0126, 'list is empty']!! # severe
{
    _x lt 2 =&gt; [E0127, 'I'd have loved more']! # warning
    
    _x gt ${ctx.threshold} =&gt; [E0128, 'Ok, that's way too much']! # warning
}
</code></pre>
<p>Here, a declaration <code>_x</code> holds the function <code>@len</code> value after applying to <code>item.list</code> identifier. Later on, inside the block, <code>_x</code> is used for validating some warnings.</p>
<p>The funny looking <code>${ctx.threshold}</code> literal, happens to reference a field in the <code>context struct</code>.</p>
<p>With <code>${...}</code> you have the ability to check against the referenced structures within the code that you pass to the <em>mooncake</em> executor.</p>
<p>Now that the rules are written and also executed (see <a href="https://github.com/talal830/mooncake">github</a> for execution details), we would have our result in a structure composing of arrays of all the fatals', severe's, warnings' encountered during validation.</p>
<p>Pretty much like this:</p>
<pre><code>{
   "Fatal":[
      {
         "Code":"E0122",
         "Info":"item is nil"
      }
   ],
   "Severe":[],
   "Warning":[]
}

</code></pre>
<p>For the list of all operators, functions, errors and syntax related stuff please see the Readme on mooncake's repository: <a href="https://github.com/talal830/mooncake">https://github.com/talal830/mooncake</a></p>
<p>Let's see where it goes from here :)</p>
</div>
                </div>
            </section>


            <footer class="post-full-footer">


                    
<section class="author-card">
        <span class="avatar-wrapper"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"></path></g></svg>
</span>
    <section class="author-card-content">
        <h4 class="author-card-name"><a href="../author/talal/">Talal Ahmed</a></h4>
            <p>Read <a href="../author/talal/">more posts</a> by this author.</p>
    </section>
</section>
<div class="post-full-footer-right">
    <a class="author-card-button" href="../author/talal/">Read More</a>
</div>


            </footer>


        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">


                <article class="post-card post no-image">
    <div class="post-card-content">
        <a class="post-card-content-link" href="../using-software-product-lines-in-gaming-backends/">
            <header class="post-card-header">
                <h2 class="post-card-title">Using Software Product Lines (SPL) in Gaming Backends</h2>
            </header>
            <section class="post-card-excerpt">
                <p>writing in progress...</p>
            </section>
        </a>
        <footer class="post-card-meta">

            <ul class="author-list">
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Talal Ahmed
                    </div>

                        <a href="../author/talal/" class="static-avatar author-profile-image"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"></path></g></svg>
</a>
                </li>
            </ul>

            <span class="reading-time">1 min read</span>

        </footer>
    </div>
</article>

        </div>
    </div>
</aside>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="http://localhost:2368">
            <span>Talal's Zone</span>
        </a>
    </div>
    <span class="floating-header-divider">—</span>
    <div class="floating-header-title">Mooncake: A simplistic validation language</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"></path>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Mooncake%3A%20A%20simplistic%20validation%20language&amp;url=http://localhost:2368/mooncake/" onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"></path></svg>
        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/mooncake/" onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"></path></svg>
        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:2368">Talal's Zone</a> © 2019</section>
                <nav class="site-footer-nav">
                    <a href="http://localhost:2368">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=dc42388709"></script>


    <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();

});
</script>


    

</body>
